(this["webpackJsonpwe-call"]=this["webpackJsonpwe-call"]||[]).push([[0],{31:function(e,t,c){},32:function(e,t,c){},39:function(e,t){function c(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}c.keys=function(){return[]},c.resolve=c,e.exports=c,c.id=39},41:function(e,t,c){},42:function(e,t,c){},43:function(e,t,c){},44:function(e,t,c){},45:function(e,t,c){"use strict";c.r(t);var n=c(1),a=c.n(n),r=c(23),s=c.n(r),i=(c(31),c(8)),o=c(2),l=(c(32),c(0));var d=function(){return Object(l.jsxs)("header",{className:"App-header",children:[Object(l.jsx)("img",{src:"/we-call/logo512.png",className:"App-logo",alt:"WeCall Logo"}),Object(l.jsx)("h3",{className:"flow-text",children:"O que deseja fazer?"}),Object(l.jsx)(i.b,{to:"/create",className:"blue waves-effect waves-light btn-large",children:"Criar sala"}),Object(l.jsx)(i.b,{to:"/join",className:"blue waves-effect waves-light btn-large",children:"Entrar em sala"})]})},u=c(3),j=c(15),b=c.n(j),m=c(16),O=c(9),p=a.a.createContext();function h(e){var t=e.children,c=Object(n.useState)(""),a=Object(u.a)(c,2),r=a[0],s=a[1],i=Object(n.useState)({type:"semi-group",controls:{mic:!0,cam:!0,screen:!0}}),o=Object(u.a)(i,2),d=o[0],j=o[1];return Object(l.jsx)(p.Provider,{value:{roomId:r,setRoomId:s,roomSettings:d,updateType:function(e){j(Object(O.a)(Object(O.a)({},d),{},{type:e.target.value}))},updateControls:function(e){j(Object(O.a)(Object(O.a)({},d),{},{controls:Object(O.a)(Object(O.a)({},d.controls),{},Object(m.a)({},e.target.value,e.target.checked))}))}},children:t})}var f=c(13),v=c.n(f),x=c(21);function g(){return(g=Object(x.a)(v.a.mark((function e(){var t,c=arguments;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.length>0&&void 0!==c[0]?c[0]:{video:!0,audio:!0},e.abrupt("return",navigator.mediaDevices.getUserMedia(t));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(){return(C=Object(x.a)(v.a.mark((function e(){var t,c=arguments;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.length>0&&void 0!==c[0]?c[0]:{video:!0},e.abrupt("return",navigator.mediaDevices.getDisplayMedia(t));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var S={endMediaStream:function(e){e.getTracks().forEach((function(e){e.stop()}))},getScreen:function(){return C.apply(this,arguments)},getUserMedia:function(){return g.apply(this,arguments)},replaceAudio:function(e,t,c){var n=e.getAudioTracks()[0];c?c.peerConnection.getSenders()[0].replaceTrack(n):(t.removeTrack(t.getAudioTracks()[0]),t.addTrack(n))},replaceVideo:function(e,t,c){var n=e.getVideoTracks()[0];c?c.peerConnection.getSenders()[1].replaceTrack(n):(t.removeTrack(t.getVideoTracks()[0]),t.addTrack(n))},toggleAudio:function(e,t){t?t.peerConnection.getSenders()[0].track.enabled=!t.peerConnection.getSenders()[0].track.enabled:e.getAudioTracks()[0].enabled=!e.getAudioTracks()[0].enabled},toggleVideo:function(e,t){t?t.peerConnection.getSenders()[1].track.enabled=!t.peerConnection.getSenders()[1].track.enabled:e.getVideoTracks()[0].enabled=!e.getVideoTracks()[0].enabled},isMobile:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}},N=a.a.createContext();function y(e){var t=e.children,c=Object(n.useState)(null),a=Object(u.a)(c,2),r=a[0],s=a[1],i=Object(n.useState)(""),d=Object(u.a)(i,2),j=d[0],b=d[1],m=Object(n.useState)(null),O=Object(u.a)(m,2),p=O[0],h=O[1],f=Object(n.useState)(null),v=Object(u.a)(f,2),x=v[0],g=v[1],C=Object(n.useState)([]),y=Object(u.a)(C,2),k=y[0],w=y[1],T=Object(n.useState)(""),V=Object(u.a)(T,2),M=V[0],E=V[1],I=Object(o.f)();return Object(l.jsx)(N.Provider,{value:{peer:r,setPeer:s,roomType:j,setRoomType:b,localStream:p,setLocalStream:h,screenStream:x,setScreenStream:g,calls:k,setCalls:w,msg:M,setMsg:E,handleMic:function(){k.length>0?S.toggleAudio(null,k[0]):S.toggleAudio(p)},handleCam:function(){k.length>0?S.toggleVideo(null,k[0]):S.toggleVideo(p)},handleScreenShare:function(){x?(S.replaceVideo(p,k[0]),S.endMediaStream(x),g(null)):S.getScreen().then((function(e){k.forEach((function(t){return S.replaceVideo(e,null,t)})),e.getVideoTracks()[0].addEventListener("ended",(function(){S.replaceVideo(p,null,k[0]),g(null)})),g(e)}),(function(e){console.log(e)}))},handleCallEnd:function(){for(var e in console.log(r.connections),r.connections)r.connections[e].forEach((function(e){e.close()}));S.endMediaStream(p),h(null),g(null),I.push("/call-end")}},children:t})}var k=function(e){var t=e.title,c=e.onSubmit,n=e.submitText,a=e.children;return Object(l.jsx)("section",{className:"row",children:Object(l.jsx)("div",{className:"col s12 m8 offset-m2",children:Object(l.jsx)("div",{className:"card grey darken-2",children:Object(l.jsxs)("div",{className:"card-content",children:[Object(l.jsx)("span",{className:"card-title",children:t}),Object(l.jsxs)("form",{className:"row",onSubmit:c,children:[a,Object(l.jsx)("div",{className:"input-field col s12",children:Object(l.jsx)("button",{type:"submit",className:"btn blue",children:n})})]})]})})})})};c(41);var w=function(){return Object(l.jsx)("div",{className:"loader"})};var T=function(e){var t=e.name,c=e.list,n=e.value,a=e.updateValue;return c.map((function(e,c){return Object(l.jsx)("p",{children:Object(l.jsxs)("label",{children:[Object(l.jsx)("input",{type:"radio",className:"with-gap",name:t,value:e.prop,checked:n===e.prop,onChange:a}),Object(l.jsx)("span",{className:"white-text",children:e.text})]})},c)}))};var V=function(e){var t=e.list,c=e.values,n=e.updateValues;return t.map((function(e,t){return Object(l.jsx)("p",{children:Object(l.jsxs)("label",{children:[Object(l.jsx)("input",{type:"checkbox",className:"filled-in",value:e.prop,checked:c[e.prop],onChange:n}),Object(l.jsx)("span",{className:"white-text",children:e.text})]})},t)}))};var M=function(){var e=Object(n.useContext)(p),t=e.roomId,c=e.setRoomId,a=e.roomSettings,r=e.updateType,s=e.updateControls,i=Object(n.useContext)(N),d=i.setPeer,j=i.setRoomType,m=Object(n.useState)(!1),O=Object(u.a)(m,2),h=O[0],f=O[1],v=Object(o.f)();return h?Object(l.jsx)(w,{}):Object(l.jsxs)(k,{title:"Op\xe7\xf5es da Sala",onSubmit:function(e){e.preventDefault();var c=new b.a(t,{debug:3});f(!0),j(a.type),d(c),c.on("open",(function(e){v.push("room/".concat(e),a.controls)}))},submitText:"Criar",children:[Object(l.jsxs)("div",{className:"input-field col s12",children:[Object(l.jsx)("p",{children:"Tipo de sala:"}),Object(l.jsx)(T,{name:"roomType",list:[{prop:"semi-group",text:"Semi-grupo (os participantes s\xf3 podem se comunicar com o anfitri\xe3o)"},{prop:"group",text:"Grupo (todos podem se comunicar entre si)"}],value:a.type,updateValue:r})]}),Object(l.jsxs)("div",{className:"input-field col s12",children:[Object(l.jsx)("p",{children:"Controles dos participantes:"}),Object(l.jsx)(V,{list:[{prop:"mic",text:"Microfone"},{prop:"cam",text:"C\xe2mera"},{prop:"screen",text:"Compartilhar tela"}],values:a.controls,updateValues:s})]}),Object(l.jsxs)("div",{className:"input-field col s12",children:[Object(l.jsx)("label",{htmlFor:"roomId",children:"ID da sala (deixe em branco parar gerar um ID aleat\xf3rio):"}),Object(l.jsx)("input",{type:"text",id:"roomId",value:t,onChange:function(e){return c(e.target.value)},placeholder:"ID da sala"})]})]})};var E=function(){var e=Object(o.f)();return Object(l.jsx)(k,{title:"Entrar na Sala",onSubmit:function(){var t=document.getElementById("room-id").value;e.push("room/".concat(t))},submitText:"Entrar",children:Object(l.jsx)("div",{className:"input-field col s12",children:Object(l.jsx)("input",{placeholder:"Cole aqui o ID da sala",id:"room-id",type:"text"})})})},I=a.a.createContext();function A(e){var t=e.children,c=Object(n.useState)(!1),a=Object(u.a)(c,2),r=a[0],s=a[1],i=Object(n.useState)(!0),o=Object(u.a)(i,2),d=o[0],j=o[1],b=Object(n.useState)(!0),m=Object(u.a)(b,2),O=m[0],p=m[1];return Object(l.jsx)(I.Provider,{value:{isVisible:r,setIsVisible:s,handleOpen:function(){s(!0)},micOpen:d,setMicOpen:j,camOpen:O,setCamOpen:p},children:t})}var D=c(25),P=c(26);c(42);function L(e){e.ref;var t=e.srcObject,c=Object(P.a)(e,["ref","srcObject"]),a=Object(n.useRef)(null);return Object(n.useEffect)((function(){a.current&&(a.current.srcObject=t)}),[t]),Object(l.jsx)("video",Object(O.a)({ref:a},c))}var F=function(e){var t=e.list,c=1,a=1;t.length>=10?(c=5,a=Math.floor(t.length/5)):t.length>2?(c=Math.ceil(t.length/2),a=2):(c=t.length,a=1);var r=document.querySelector(".App"),s=r.clientWidth/c-4,i=r.clientHeight/a-4;Object(n.useEffect)((function(){var e=document.querySelector(".Video-List");e.style.setProperty("--cols",c),e.style.setProperty("--rows",a)}),[c]);var o=t.map((function(e,t){return Object(l.jsx)("div",{className:"Video-List-item",style:{width:s,height:i},children:Object(l.jsx)(L,{srcObject:e.stream,autoPlay:!0})},t)}));return Object(l.jsx)("section",{className:"Video-List",children:o})};var R=function(e){var t=e.roomControls,c=e.children,a=Object(n.useContext)(N),r=a.peer,s=a.roomType,i=a.localStream,o=a.calls,d=a.setCalls,u=Object(n.useRef)();u.current=i;var j=Object(n.useRef)();function b(e){var t=j.current.filter((function(t){return t.peer!==e.peer}));d(t)}return j.current=o,Object(n.useEffect)((function(){r.on("connection",(function(e){e.on("open",(function(){e.send({roomType:s,roomControls:t})})),function(e){var t=r.call(e.peer,u.current);t.on("stream",(function(e){j.current.some((function(e){return e.peer===t.peer}))||(t.stream=e,d([].concat(Object(D.a)(j.current),[t])))})),e.on("close",(function(){return b(e)})),e.peerConnection.oniceconnectionstatechange=function(){"disconnected"===e.peerConnection.iceConnectionState&&b(e)}}(e)}))}),[]),Object(l.jsxs)(l.Fragment,{children:[o.length>0?Object(l.jsx)(F,{list:o}):Object(l.jsx)("p",{children:"Aguardando conex\xe3o..."}),c]})};c(43);var _=function(e){var t=e.children,c=e.mic,a=e.cam,r=Object(n.useContext)(I),s=r.isVisible,i=r.setIsVisible,o=r.micOpen,d=r.camOpen,j=Object(n.useContext)(N),b=j.calls,m=j.localStream,O=j.setLocalStream,p=Object(n.useState)([]),h=Object(u.a)(p,2),f=h[0],v=h[1],x=Object(n.useState)(!1),g=Object(u.a)(x,2),C=g[0],y=g[1];function k(e){if("audio-inputs"===e.target.id){var t={video:{deviceId:m.getVideoTracks()[0].getSettings().deviceId},audio:{deviceId:e.target.value}};navigator.mediaDevices.getUserMedia(t).then((function(e){S.replaceAudio(e,m,b[0]),e.getAudioTracks()[0].enabled=o,O(e)}))}else if("video-inputs"===e.target.id){var c={video:{deviceId:e.target.value},audio:{deviceId:m.getAudioTracks()[0].getSettings().deviceId}};navigator.mediaDevices.getUserMedia(c).then((function(e){S.replaceVideo(e,m,b[0]),e.getVideoTracks()[0].enabled=d,O(e)}))}}return Object(n.useEffect)((function(){navigator.mediaDevices.enumerateDevices().then((function(e){v(e)}))}),[]),Object(l.jsxs)("section",{className:"Settings ".concat(s?"show":""),children:[t,Object(l.jsxs)("div",{className:"row",children:[c&&Object(l.jsxs)("div",{className:"input-field col s12",children:[Object(l.jsx)("label",{htmlFor:"audio-inputs",children:"Entrada de \xe1udio (microfone):"}),Object(l.jsx)("select",{id:"audio-inputs",className:"browser-default",onChange:k,children:f.filter((function(e){return"audioinput"===e.kind})).map((function(e,t){return Object(l.jsx)("option",{value:e.deviceId,children:e.label},t)}))})]}),a&&Object(l.jsxs)(l.Fragment,{children:[Object(l.jsxs)("div",{className:"input-field col s12",children:[Object(l.jsx)("label",{htmlFor:"video-inputs",children:"Entrada de v\xeddeo (c\xe2mera):"}),Object(l.jsx)("select",{id:"video-inputs",className:"browser-default",onChange:k,children:f.filter((function(e){return"videoinput"===e.kind})).map((function(e,t){return Object(l.jsx)("option",{value:e.deviceId,children:e.label},t)}))})]}),Object(l.jsx)("div",{className:"input-field col s12",children:Object(l.jsxs)("label",{children:[Object(l.jsx)("input",{type:"checkbox",className:"filled-in",checked:C,onChange:function(){var e=document.querySelector(".local-vid");C?e.style.transform=e.style.transform.replace("scaleX(-1)",""):e.style.transform+="scaleX(-1)",y(!C)}}),Object(l.jsx)("span",{children:"Espelhar v\xeddeo"})]})})]})]}),Object(l.jsx)("button",{className:"btn waves-effect waves-light blue",onClick:function(){i(!1)},children:"OK"})]})};c(44);var U=function(e){var t=e.mic,c=e.cam,a=e.screen,r=Object(n.useContext)(N),s=r.calls,i=r.screenStream,o=r.handleMic,d=r.handleCam,u=r.handleScreenShare,j=r.handleCallEnd,b=Object(n.useContext)(I),m=b.handleOpen,O=b.micOpen,p=b.setMicOpen,h=b.camOpen,f=b.setCamOpen;return Object(l.jsxs)("div",{className:"Toolbar",children:[t&&Object(l.jsx)("button",{className:"btn-floating btn-large waves-effect waves-light blue",onClick:function(){o(),p(!O)},children:Object(l.jsx)("i",{className:"material-icons",children:O?"mic":"mic_off"})}),c&&Object(l.jsx)("button",{className:"btn-floating btn-large waves-effect waves-light blue",onClick:function(){d(),f(!h)},children:Object(l.jsx)("i",{className:"material-icons",children:h?"videocam":"videocam_off"})}),a&&(null===s||void 0===s?void 0:s.length)>0&&!S.isMobile()&&Object(l.jsx)("button",{className:"btn-floating btn-large waves-effect waves-light blue",onClick:u,children:Object(l.jsx)("i",{className:"material-icons",children:i?"stop_screen_share":"screen_share"})}),(t||c)&&Object(l.jsx)("button",{className:"btn-floating btn-large waves-effect waves-light grey darken-2",onClick:m,children:Object(l.jsx)("i",{className:"material-icons",children:"settings"})}),Object(l.jsx)("button",{className:"btn-floating btn-large waves-effect waves-light red",onClick:j,children:Object(l.jsx)("i",{className:"material-icons",children:"call_end"})})]})};var q=function(e){var t=e.controls,c=e.setControls,a=Object(n.useContext)(N),r=a.peer,s=(a.roomType,a.setRoomType),i=a.localStream,d=a.calls,u=a.setCalls,j=a.msg,b=a.setMsg,m=Object(o.h)().id,O=Object(n.useRef)();return O.current=j,Object(n.useEffect)((function(){var e=r.connect(m);b("Tentando conectar..."),e.on("open",(function(){e.on("data",(function(e){s(e.roomType),c(e.roomControls)}))})),r.on("call",(function(e){b("Conex\xe3o estabelecida"),e.answer(i),e.on("stream",(function(c){e.stream=c,u([e]),t.mic||(e.peerConnection.getSenders()[0].track.enabled=!1)}))})),e.on("close",(function(){b("O anfitri\xe3o saiu da sala"),u([])})),e.peerConnection.oniceconnectionstatechange=function(){"disconnected"===e.peerConnection.iceConnectionState&&(b("O anfitri\xe3o saiu da sala"),u([]))}}),[]),Object(l.jsxs)(l.Fragment,{children:[d.length>0?Object(l.jsx)(L,{srcObject:d[0].stream,autoPlay:!0}):Object(l.jsx)("p",{children:O.current}),Object(l.jsxs)(A,{children:[Object(l.jsx)(U,{mic:t.mic,cam:t.cam,screen:t.screen}),Object(l.jsx)(_,{mic:t.mic,cam:t.cam})]})]})};var B=function(){var e=Object(o.h)().id;return Object(l.jsx)(l.Fragment,{children:Object(l.jsxs)("div",{className:"row",children:[Object(l.jsx)("div",{className:"col s12 m3",children:Object(l.jsx)("p",{children:"Link da sala:"})}),Object(l.jsx)("div",{className:"col s9 m6",children:Object(l.jsx)("input",{type:"text",readOnly:!0,id:"room-id",value:"".concat(window.location.origin,"/room/").concat(e)})}),Object(l.jsx)("div",{className:"col s3",children:Object(l.jsx)("button",{className:"blue waves-effect btn",onClick:function(){var e=document.getElementById("room-id");e.select(),e.setSelectionRange(0,99999),document.execCommand("copy")},children:"Copiar Link"})})]})})};var J=function(){var e=Object(n.useContext)(N),t=e.peer,c=e.setPeer,a=e.localStream,r=e.setLocalStream,s=e.screenStream,i=e.setMsg,d=Object(o.h)().id,j=Object(o.g)(),m=Object(n.useState)(!1),O=Object(u.a)(m,2),p=O[0],h=O[1],f=Object(n.useState)({mic:!1,cam:!1,screen:!1}),v=Object(u.a)(f,2),x=v[0],g=v[1];return Object(n.useEffect)((function(){if(j.state&&g(j.state),null===t){var e=new b.a({debug:3});e.on("open",(function(){h(!0),e.on("error",(function(e){i("Desculpe, houve um erro"),console.log(e)}))})),c(e)}else t.id&&h(!0);S.getUserMedia().then((function(e){r(e)}))}),[]),Object(l.jsxs)(l.Fragment,{children:[p&&a&&Object(l.jsx)(l.Fragment,{children:(null===t||void 0===t?void 0:t.id)===d?Object(l.jsx)(R,{roomControls:x,children:Object(l.jsxs)(A,{children:[Object(l.jsx)(U,{mic:!0,cam:!0,screen:!0}),Object(l.jsx)(_,{mic:!0,cam:!0,children:Object(l.jsx)(B,{})})]})}):Object(l.jsx)(q,{controls:x,setControls:g})}),s?Object(l.jsx)(L,{className:"local-vid",srcObject:s,autoPlay:!0,muted:!0}):Object(l.jsx)(L,{className:"local-vid",srcObject:a,autoPlay:!0,muted:!0})]})};var W=function(){return Object(l.jsx)("div",{children:"Voc\xea saiu da sala."})};var X=function(){return Object(l.jsx)("div",{className:"App container",children:Object(l.jsx)(i.a,{basename:"/we-call",children:Object(l.jsx)(y,{children:Object(l.jsxs)(o.c,{children:[Object(l.jsx)(o.a,{path:"/create",children:Object(l.jsx)(h,{children:Object(l.jsx)(M,{})})}),Object(l.jsx)(o.a,{path:"/join",children:Object(l.jsx)(E,{})}),Object(l.jsx)(o.a,{path:"/room/:id",children:Object(l.jsx)(J,{})}),Object(l.jsx)(o.a,{path:"/call-end",children:Object(l.jsx)(W,{})}),Object(l.jsx)(o.a,{path:"/",children:Object(l.jsx)(d,{})})]})})})})};s.a.render(Object(l.jsx)(a.a.StrictMode,{children:Object(l.jsx)(X,{})}),document.getElementById("root"))}},[[45,1,2]]]);
//# sourceMappingURL=main.6ceb15cf.chunk.js.map